# 練習題 2：進階網路架構和自動擴展

## 目標
完成本練習後，您將能夠：
- 設計多層網路架構
- 配置實例組和自動擴展
- 實施負載平衡
- 設置監控和警報

## 任務

### 任務 1：設計多層網路架構
創建一個三層網路架構：
- **公共子網路** (DMZ): `10.0.1.0/24` - 放置負載平衡器和Web服務器
- **私有子網路** (應用層): `10.0.2.0/24` - 放置應用服務器
- **數據庫子網路** (數據層): `10.0.3.0/24` - 為未來數據庫預留

### 任務 2：配置Cloud NAT
為私有子網路配置Cloud NAT，提供出站網路連接。

### 任務 3：創建實例組和自動擴展
創建一個實例組管理器：
- 使用實例模板
- 配置自動擴展 (最小1個，最大5個)
- 基於CPU使用率擴展 (閾值60%)
- 配置健康檢查

### 任務 4：設置負載平衡器
創建HTTP負載平衡器：
- 分發流量到實例組
- 配置健康檢查
- 設置會話親和性

### 任務 5：實施監控和警報
設置監控警報：
- CPU使用率 > 80%
- 磁碟使用率 > 90%
- 實例健康狀態

## 要求

1. **網路安全**：
   - 分層防火牆規則
   - 限制跨層通信
   - 實施最小權限原則

2. **高可用性**：
   - 多可用區部署
   - 自動故障轉移
   - 健康檢查

3. **可擴展性**：
   - 自動擴展配置
   - 負載分散
   - 性能監控

4. **成本優化**：
   - 使用適當的機器類型
   - 監控資源使用
   - 實施清理策略

## 評分標準

- **架構設計** (30%)：網路架構合理，符合最佳實踐
- **功能實現** (30%)：所有功能正常運作
- **安全配置** (20%)：適當的安全措施
- **監控和可觀測性** (20%)：完整的監控配置

## 提示

1. 參考 `02-vpc` 和 `03-compute` 章節
2. 使用模組化設計提高可重用性
3. 測試自動擴展功能
4. 驗證負載平衡器工作正常

## 提交要求

提交以下文件：
- `main.tf` - 主要資源定義
- `variables.tf` - 變數定義
- `outputs.tf` - 輸出定義
- `terraform.tfvars.example` - 變數範例
- `README.md` - 架構說明文檔
- `monitoring.md` - 監控配置說明

## 時間限制

建議完成時間：4-5小時

## 難度等級

⭐⭐⭐☆☆ (中級)

## 進階挑戰

完成基本要求後，可以嘗試：
1. 添加SSL證書和HTTPS重定向
2. 實施藍綠部署
3. 配置CDN
4. 設置災難恢復
